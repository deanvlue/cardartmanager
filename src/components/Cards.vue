<template>
  <div class="container">
    <div class="row">
      <div class="col-sm-9">
        <form class="form-cards" v-on:submit.prevent="submitData">
          <h2>Configuración de Bines</h2>
          <label for="inicialBin" class="">Bin Inicial</label>
          <input @blur="isValidBin"
           v-model="cardConfig.inicialbin" type="text" id="inicialBin" class="form-control" placeholder="6666666666666666" required autofocus>
          <label for="finalBin" class="">Bin Final</label>
          <input @blur="isValidBin" v-model="cardConfig.finalbin" type="text" id="finalBin" class="form-control" placeholder="9999999999999999" required>
          <label for="promo" class="">Promo</label>
          <input v-model="cardConfig.promo" type="text" id="promo" class="form-control" placeholder="12345" required>
          <br>
          <button class="btn btn-lg btn-primary btn-block">Guardar</button>
        </form>
      </div>
      <div class="col-sm-3">
        <div class="cardSelector">
            <div v-if="arts.length < 1">
              Cargando...
            </div>
            <div class="list-group">
              <button @click="selectArt" :id="art.name" v-for="art in arts" v-bind:key="art.name" type="button" class="list-group-item list-group-item-action">
                <img :src="art.uri" class="img-responsive img-thumbnail" :alt="art.name"> | {{art.name}}
              </button>
            </div>
          </div>
        </div>
    </div>
    <div class="row">
      <div class="col">
        <pre>
          <code>
          {{ cardConfig}}
          </code>
        </pre>
      </div>
    </div>
  </div>
</template>

<script>
/* eslint-disable */
import * as axios from 'axios';

const BASE_URL = 'https://fnsbxcardart.azurewebsites.net/api/GetArts'
export default {
  name: 'Cards',
  data () {
    return {
      msg: "Aquí se suben las cards",
      arts:[],
      selectedImage: null,
      cardConfig: {
        inicialbin: null,
        finalbin: null,
        promo: null,
        active: true,
        imageurl: []
      }

    }
  },
  computed:{
  },
  methods:{
    selectArt(event){
      //console.log(event.target.id)
      this.selected_image = event.target.id
      this.cardConfig.imageurl = [];
      this.imageurls(event.target.id);

    },
    imageurls(artname){
        const uri = 'https://stfnsbxcardart.blob.core.windows.net/cardsartssized/'
        let imageurl =[];

        const artSizes = [
          "androidThumbXxhdpi",
          "androidThumbXhdpi", 
          "androidThumbHdpi", 
          "androidThumbMdpi", 
          "androidFullXxhdpi",
          "androidFullXhdpi", 
          "androidFullHdpi", 
          "androidFullMdpi",
          "iosLargeHighRes",
          "iosLarge",
          "iosThumbHighRes", 
          "iosThumb",
          "ImageStrip",
          "ImageLarge",
          "ImageMedium",
          "ImageSmall",
          "ImageIcon",
        ].map((x)=>{
          let imageconfig = {
            imageType: x,
            uri: `${uri}${artname.split(".")[0]}_${x}.${artname.split(".")[1]}`
          }
          
          this.cardConfig.imageurl.push(imageconfig)
      });
    },
    isValidBin(e){
      e.preventDefault();
      let regex = /[0-9]{16}/
      if (!regex.test(e.target.value)){
        alert("Revisa tus Bines")
      }
    },
    validateFields(){
      let binRegex = /[0-9]{16}/
      let promoRegex = /[0-9]*/
        return binRegex.test(this.cardConfig.inicialbin)
          && binRegex.test(this.cardConfig.finalbin)
          && promoRegex.test(this.cardConfig.promo)
          && this.cardConfig.imageurl.length > 0
    },
    submitData(e){
      //e.preventDefault();
      if( validateFields()){
          // Save to API
        }else{
          // Error
          e.preventDefault();
          alert("Hay errores en la información, favor de validar")
        }
    }
  },
  mounted(){
    axios.get(BASE_URL)
    .then((res)=>{
      //console.log(res.data.arts)
      this.arts = res.data.arts;
    })
    .catch(err=>{
      console.log(err)
    })
  }
}
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
h1, h2 {
  font-weight: normal;
}
ul {
  list-style-type: none;
  padding: 0;
}
li {
  display: inline-block;
  margin: 0 10px;
}
a {
  color: #42b983;
}
.form-cards{
  max-width: 400px;
  padding: 15px;
  margin: 0 auto;
}

.sr-only{
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  clip: rect(0,0,0,0);
  border: 0;
}
.img-thumbnail{
  width: 90px;
}

.cardSelector{
  max-width: 300px;
  align-content: flex-start;
}
</style>
